---
title: "Programs"
author:
  '1':
    name: Lars Vilhuber
date: "`r Sys.Date()`"
output:
  html_document:
    keep_md: yes
    number_sections: yes
  pdf_document: default
editor_options:
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
# Program directory
This directory contains all programs necessary to run the cleaning, analysis, etc. They can be run separately, or in a single run. 

## Setup
Most parameters are set in the `config.R`:
```{r setup_config}
source(file.path(rprojroot::find_rstudio_root_file(),"pathconfig.R"),echo=TRUE)
source(file.path(programs,"config.R"), echo=TRUE)
```

Note that the path `interwrk` is transitory, and is only kept during processing. It will be empty in the replication archive.




## Download and unpack the O&ast;NET data

 - Input data: O&ast;NET 
 - Output data: path `acquired'
 - this part is only run on-demand (manually)
 
```{r download_onet,eval=FALSE,cache=TRUE}
source(file.path(programs,"01_download_onet.R"),echo=TRUE)
```
## Download SOC data
We can download definitions from `r soc_definitions_loc`. In particular, we might be interested in the major groupings. (not done yet)


## Mapping job titles to SOC

We merge the alternate titles (as defined by O&ast;Net) and the BLS data (merged in via occupational code).
We keep all observations in our normative list of NLM-state related occupations.

```{r subselect_onet,eval=TRUE,cache=TRUE,echo=FALSE}
source(file.path(programs,"02_subset_onet.R"),echo=TRUE)
```

## Results

The following table lists the annual salaries by job title (median, and the 25% and 75% percentile). Blank salaries ("NA") indicate that no occupation code could be found on O&ast;Net based on the normative description. We only print one line per normative job title - these might map to the same occupation code (SOC). 

```{r table1}
nlm.extract <- nlm.titles %>% 
  distinct(`Job Title`,SOC,.keep_all = TRUE) %>% 
  select("Job Title","Title","SOC", "Alternate Title","A_PCT25","A_MEDIAN","A_PCT75")
kable(nlm.extract)
saveRDS(nlm.extract,file = file.path(outputs,"nlm.extract.RDS"))
write.csv(nlm.extract,file=file.path(outputs,"nlm.extract.csv"))
```
We collapse the raw data into the minimum "PCT25" number, the median "MEDIAN" number, and the maximum "PCT75" number to get a range:

```{r table2}
nlm.collapsed <- nlm.extract  %>% group_by(`Job Title`) %>%
  summarise(PCT25 = min(A_PCT25),MEDIAN = median(A_MEDIAN),PCT75=max(A_PCT75))
kable(nlm.collapsed)
saveRDS(nlm.collapsed,file = file.path(outputs,"nlm.collapsed.RDS"))
write.csv(nlm.collapsed,file=file.path(outputs,"nlm.collapsed.csv"))
```


